<!DOCTYPE html>
<html>
<head>
	<title>Search</title>
	<script src="http://yandex.st/jquery/1.8.3/jquery.min.js" type="text/javascript"></script>
	<script>
	    $(document).ready(function(){
			var minlen = 2; 
			var paddingtop = 30; // отступ сверху при прокрутке
			var scrollspeed = 200; // время прокрутки
			var keyint = 1000; // интервал между нажатиями клавиш
			var search = '';
			var n = 0;
			var time_keyup = 0;
			var time_search = 0;
		
		 	$('body').delegate('#spgo', 'click', function(){
		  		$('body,html').animate({scrollTop: $('span.highlight:first').offset().top-paddingtop}, scrollspeed);
		 	});
		 
		 	function dosearch() {
		  		search = $('#spsearch').val();
		  		$('span.highlight').each(function(){ 
		   		$(this).after($(this).html()).remove();  
		  		});
		  		var t = '';
		  		$('div#content').each(function(){
			   		$(this).html($(this).html().replace(new RegExp(search, 'ig'), '<span class="highlight">$&</span>')); // выделяем найденные фрагменты
			   		n = $('span.highlight').length; // количество найденных фрагментов
			   		console.log('n = '+n);
			   		if (n==0)
			    		$('#result').html('Ничего не найдено');
			   		else
			    		$('#result').html('Результатов: '+n+'. <span class="splink" id="spgo">Перейти</span>'); 
			   		if (n>1) // если больше одного фрагмента, то добавляем переход между ними
			   		{
			    		var i = 0;
			    		$('span.highlight').each(function(i){
			     			$(this).attr('n', i++); // нумеруем фрагменты
			    		});
			    		$('span.highlight').not(':last').attr({title: 'Нажмите, чтобы перейти к следующему фрагменту'}).click(function(){ // всем фрагментам, кроме последнего, добавляем подсказку
			     			$('body,html').animate({scrollTop: $('span.highlight:gt('+$(this).attr('n')+'):first').offset().top-paddingtop}, scrollspeed); // переход к следующему фрагменту
			    		});
			    		$('span.highlight:last').attr({title: 'Нажмите, чтобы вернуться к форме поиска'}).click(function(){
			     			$('body,html').animate({scrollTop: $('#spsearch').offset().top-paddingtop}, scrollspeed); // переход к форме поиска
			    		});
			   		}	 
		  		});
		 	}

		 	$('#spsearch').keyup(function(){
		  		var d1 = new Date();
		  		time_keyup = d1.getTime();
		  			if ($('#spsearch').val()!=search) // проверяем, изменилась ли строка
		   			if ($('#spsearch').val().length>=minlen) { // проверяем длину строки
		    			setTimeout(function(){ // ждем следующего нажатия
		     			var d2 = new Date();
		     			time_search = d2.getTime();
		     		if (time_search-time_keyup>=keyint) // проверяем интервал между нажатиями
		      			dosearch(); // если все в порядке, приступаем к поиску
		    		}, keyint); 
		   			}	
		  			else
		   				$('#result').html(' '); // если строка короткая, убираем текст из DIVа
		 	});  
		 
		 	if (window.location.hash!='')
		 		{
		  		var t = window.location.hash.substr(1, 50); // вырезаем текст
		  		$('#spsearch').val(t).keyup(); // вставляем его в форму поиска
		  		$('#spgo').click(); // переходим к первому фрагменту
		 	} 
		});
	  </script>
	<style>
		span.highlight {
		background-color: #C6D9DB; cursor: pointer; }
		span.splink {
		color: #0A5794; cursor: pointer; }
	</style>

</head>
<body>
	<label style="">Найти на странице</label>
	<input id="spsearch" type="text" name="spsearch" placeholder="Что искать?">
	<div id="result">&nbsp;</div>
	<div id="content">
		<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p><p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	<p>Язык программирования JavaScript (JS) придает веб-страницам возможность реагировать на действия пользователя и превращать статичные страницы в динамические, так, чтобы страницы буквально "оживали" на глазах.
Данный язык программирования является клиентским (выполняется на стороне пользователя, без использования сервера). Если вы нацелены на изучение данного клиентского языка, то лучший способ сделать это - начать программировать на нем.</p>
	</div>
	


</body>
</html>